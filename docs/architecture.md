# GuardianAI システムアーキテクチャ

## 全体アーキテクチャ

GuardianAIは完全にオフチェーンで動作し、MetaMaskSDKを中核に据えたクライアントサイドアプリケーションです。以下の主要コンポーネントで構成されています：

```
+---------------------------------------------+
|                                             |
|              GuardianAI App                 |
|                                             |
+-----+-----------------------------------+---+
      |                                   |
      v                                   v
+-----+-------------+         +-----------+------------+
|                   |         |                        |
| UI Layer          |         | Core Services          |
| (React Native)    |         |                        |
|                   |         | +--------------------+ |
| - Dashboard       |<------->| | MetaMask SDK      | |
| - Transaction     |         | | Integration       | |
|   Monitor         |         | +--------------------+ |
| - Settings        |         |                        |
| - Intent Input    |         | +--------------------+ |
|                   |         | | Transaction        | |
|                   |         | | Monitoring Service | |
|                   |         | +--------------------+ |
|                   |         |                        |
|                   |         | +--------------------+ |
|                   |         | | Language Model     | |
|                   |         | | Integration        | |
|                   |         | +--------------------+ |
|                   |         |                        |
|                   |         | +--------------------+ |
|                   |         | | Alert System       | |
|                   |         | +--------------------+ |
|                   |         |                        |
|                   |         | +--------------------+ |
|                   |         | | P2P Communication  | |
|                   |         | | (WebRTC + DHT)     | |
|                   |         | +--------------------+ |
|                   |         |                        |
+-------------------+         +------------------------+
```

## データフロー

1. **ユーザー認証フロー**:
   - ユーザーがアプリを起動
   - MetaMaskSDKを通じてウォレット接続
   - 署名ベースの認証で本人確認
   - ローカルストレージにセッション情報保存

2. **意図設定フロー**:
   - ユーザーが自然言語で取引意図を入力
   - 言語モデルが入力を解析
   - 構造化されたルールセットに変換
   - ローカルストレージに保存

3. **トランザクション監視フロー**:
   - MetaMaskSDKを通じてトランザクションイベントをリッスン
   - トランザクションデータを取得
   - ユーザー設定の意図と照合
   - 判定結果に基づいて承認/警告

4. **アラートフロー**:
   - 想定外トランザクション検出
   - アラートレベル判定
   - 犬の鳴き声など適切な通知を再生
   - ユーザーに確認を要求

5. **トークン評価フロー**:
   - トークンデータを取得
   - 言語モデルによる評価
   - 評価結果と理由を表示
   - ユーザーにアドバイス提供

## コンポーネント詳細

### 1. MetaMask SDK 統合モジュール
- ウォレット接続管理
- トランザクション署名と送信
- アカウント情報取得
- ネットワーク管理

### 2. トランザクション監視サービス
- トランザクションリスナー
- トランザクション分析エンジン
- ルール適用システム
- 承認/拒否ハンドラー

### 3. 言語モデル統合
- 自然言語処理インターフェース
- 意図解析エンジン
- トークン評価システム
- オフライン処理最適化

### 4. アラートシステム
- 通知マネージャー
- サウンドプレーヤー
- アラートレベル管理
- ユーザーフィードバックハンドラー

### 5. P2P通信モジュール
- WebRTC接続管理
- 分散ハッシュテーブル統合
- ピア検出
- データ同期

### 6. UI レイヤー
- ダッシュボード
- トランザクションモニター
- 設定画面
- 意図入力インターフェース

## セキュリティモデル

GuardianAIは以下のセキュリティ原則に基づいて設計されています：

1. **セルフカストディアル原則**:
   - プライベートキーはMetaMaskウォレット内でのみ管理
   - アプリはキーにアクセスせず、署名要求のみ送信

2. **データプライバシー**:
   - すべてのデータはローカルに保存
   - 外部サーバーへのデータ送信なし
   - 暗号化されたローカルストレージ

3. **API キー管理**:
   - AIモデルへのAPIキーはMetaMaskウォレット内に保存
   - 暗号化されたストレージで保護

4. **P2P通信セキュリティ**:
   - エンドツーエンド暗号化
   - 署名ベースの認証
   - リプレイ攻撃防止
